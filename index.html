<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>垃圾回收日历 (ゴミ収集カレンダー)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* 桌面端样式 */
        .calendar-grid { border: 2px solid black; }
        .calendar-cell { border: 1px solid black; min-height: 120px; transition: background-color 0.2s; cursor: pointer; }
        .calendar-header { border-bottom: 2px solid black; border-right: 1px solid black; }
        .calendar-header:last-child { border-right: none; }

        /* 手机端特别优化 */
        @media (max-width: 768px) {
            .calendar-cell { min-height: 80px; } /* 手机上格子高度减小 */
            .calendar-grid { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; } /* 手机上圆角柔和边框 */
            .calendar-cell { border: 1px solid #eee; border-top: none; border-left: none; }
            .calendar-header { border-bottom: 1px solid #ddd; border-right: none; font-size: 0.9rem; }
        }
        
        /* 垃圾类型颜色定义 */
        .tag-burnable { background-color: #fee2e2; color: #991b1b; } 
        .tag-nonburnable { background-color: #f3f4f6; color: #1f2937; }
        .tag-plastic { background-color: #dbeafe; color: #1e40af; }
        .tag-resource { background-color: #fef9c3; color: #854d0e; }
        .tag-pet { background-color: #dcfce7; color: #166534; }

        /* 弹窗动画 */
        .modal-enter { animation: fadeIn 0.2s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 pb-10">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const WEEKDAYS = ['日', '月', '火', '水', '木', '金', '土'];
        const DEFAULT_RULES = [
            { id: 1, name: '燃やすごみ', style: 'tag-burnable', colorCode: '#ef4444', days: [3, 6], weeks: [1, 2, 3, 4, 5] },
            { id: 2, name: '燃やさないごみ', style: 'tag-nonburnable', colorCode: '#6b7280', days: [1], weeks: [1, 3] },
            { id: 3, name: 'プラスチック', style: 'tag-plastic', colorCode: '#3b82f6', days: [2], weeks: [1, 2, 3, 4, 5] },
            { id: 4, name: '古紙・びん・缶', style: 'tag-resource', colorCode: '#eab308', days: [2], weeks: [2, 4] },
            { id: 5, name: 'ペットボトル', style: 'tag-pet', colorCode: '#22c55e', days: [5], weeks: [1, 2, 3, 4, 5] },
            { id: 6, name: '発泡スチロール', style: 'tag-pet', colorCode: '#22c55e', days: [5], weeks: [1, 2, 3, 4, 5] },
            { id: 7, name: '古布', style: 'tag-pet', colorCode: '#22c55e', days: [5], weeks: [1, 2, 3, 4, 5] },
        ];

        function App() {
            // 默认设置为当前时间
            const [date, setDate] = useState(new Date()); 
            const [rules, setRules] = useState(DEFAULT_RULES);
            const [view, setView] = useState('calendar');
            
            // 弹窗状态
            const [selectedDayInfo, setSelectedDayInfo] = useState(null); // { day: 1, garbageList: [], weekDay: '月' }

            const getDaysInMonth = (d) => new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
            const getFirstDayOfMonth = (d) => new Date(d.getFullYear(), d.getMonth(), 1).getDay();

            const getGarbageForDay = (dayNum) => {
                if (!dayNum) return [];
                const currentDayDate = new Date(date.getFullYear(), date.getMonth(), dayNum);
                const dayOfWeek = currentDayDate.getDay();
                const nthWeek = Math.floor((dayNum - 1) / 7) + 1;

                return rules.filter(rule => {
                    return rule.days.includes(dayOfWeek) && rule.weeks.includes(nthWeek);
                });
            };

            const changeMonth = (offset) => {
                setDate(new Date(date.getFullYear(), date.getMonth() + offset, 1));
            };

            // 处理日期点击
            const handleDayClick = (day, garbageList, weekDayIndex) => {
                if (!day) return;
                setSelectedDayInfo({
                    day,
                    garbageList,
                    weekDay: WEEKDAYS[weekDayIndex],
                    dateObj: new Date(date.getFullYear(), date.getMonth(), day)
                });
            };

            // 关闭弹窗
            const closeModal = () => setSelectedDayInfo(null);

            // --- 渲染设置页面 ---
            if (view === 'settings') {
                return (
                    <div className="min-h-screen bg-white">
                        <div className="sticky top-0 bg-white border-b px-4 py-3 flex justify-between items-center z-10 shadow-sm">
                            <h2 className="text-lg font-bold text-gray-800">
                                <i className="fa-solid fa-gear mr-2 text-gray-500"></i>収集日設定
                            </h2>
                            <button onClick={() => setView('calendar')} className="bg-black text-white px-4 py-1.5 rounded-full text-sm font-bold shadow hover:bg-gray-800 transition">
                                完了
                            </button>
                        </div>
                        <div className="p-4 pb-20 overflow-y-auto">
                            {rules.map((rule, index) => (
                                <div key={rule.id} className="mb-6 border-b pb-4 last:border-0">
                                    <div className="flex items-center mb-3">
                                        <div className={`w-3 h-3 rounded-full mr-2 ${rule.style.replace('text-', 'bg-').split(' ')[0]}`}></div>
                                        <span className="font-bold text-gray-900">{rule.name}</span>
                                    </div>
                                    
                                    <div className="mb-3">
                                        <p className="text-xs text-gray-500 mb-1">曜日选择:</p>
                                        <div className="flex gap-2">
                                            {WEEKDAYS.map((wd, wIndex) => {
                                                const isActive = rule.days.includes(wIndex);
                                                return (
                                                    <button
                                                        key={wIndex}
                                                        onClick={() => {
                                                            const newRules = [...rules];
                                                            if (isActive) newRules[index].days = newRules[index].days.filter(d => d !== wIndex);
                                                            else newRules[index].days.push(wIndex);
                                                            setRules(newRules);
                                                        }}
                                                        className={`w-9 h-9 rounded-full text-sm font-bold flex items-center justify-center transition-colors ${
                                                            isActive 
                                                            ? 'bg-blue-600 text-white shadow-md' 
                                                            : 'bg-gray-100 text-gray-400'
                                                        }`}
                                                    >
                                                        {wd}
                                                    </button>
                                                )
                                            })}
                                        </div>
                                    </div>

                                    <div>
                                        <p className="text-xs text-gray-500 mb-1">频率:</p>
                                        <select 
                                            className="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg p-2.5"
                                            value={rule.weeks.length === 5 ? 'all' : rule.weeks.join(',')}
                                            onChange={(e) => {
                                                const val = e.target.value;
                                                const newRules = [...rules];
                                                if (val === 'all') newRules[index].weeks = [1, 2, 3, 4, 5];
                                                else newRules[index].weeks = val.split(',').map(Number);
                                                setRules(newRules);
                                            }}
                                        >
                                            <option value="all">毎週</option>
                                            <option value="1,3">第1・3週</option>
                                            <option value="2,4">第2・4週</option>
                                            <option value="1">第1週のみ</option>
                                        </select>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            // --- 渲染日历视图 ---
            const totalDays = getDaysInMonth(date);
            const firstDay = getFirstDayOfMonth(date);
            const blanks = Array(firstDay).fill(null);
            const days = Array.from({ length: totalDays }, (_, i) => i + 1);
            const allCells = [...blanks, ...days];
            const isToday = (day) => {
                const today = new Date();
                return day && today.getDate() === day && today.getMonth() === date.getMonth() && today.getFullYear() === date.getFullYear();
            }

            return (
                <div className="max-w-5xl mx-auto md:p-4 min-h-screen flex flex-col">
                    
                    {/* 顶部控制栏 */}
                    <div className="flex flex-col md:flex-row md:justify-between md:items-end mb-4 px-2 pt-2 gap-4">
                        {/* 左侧：月份切换 */}
                        <div className="flex justify-between md:justify-start items-center w-full md:w-auto">
                            <div className="flex items-center text-red-600 font-bold text-4xl gap-4">
                                <button onClick={() => changeMonth(-1)} className="hover:bg-gray-100 p-2 rounded-full active:scale-90 transition">
                                    <i className="fa-solid fa-chevron-left text-2xl"></i>
                                </button>
                                <span>{date.getMonth() + 1}<span className="text-lg text-gray-500 ml-1">月</span></span>
                                <button onClick={() => changeMonth(1)} className="hover:bg-gray-100 p-2 rounded-full active:scale-90 transition">
                                    <i className="fa-solid fa-chevron-right text-2xl"></i>
                                </button>
                            </div>
                            
                            {/* 手机端的年份显示在右侧 */}
                            <div className="md:hidden text-xl font-bold text-gray-500">
                                {date.getFullYear()}年
                            </div>
                        </div>

                        {/* 右侧：年份(桌面) 和 设置按钮 */}
                        <div className="flex items-center justify-end gap-4 md:gap-6 w-full md:w-auto">
                            {/* 桌面端年份 */}
                            <div className="hidden md:flex items-center text-4xl font-bold text-black">
                                <button onClick={() => changeMonth(-12)} className="hover:text-gray-600"><i className="fa-solid fa-caret-left mx-2 text-2xl"></i></button>
                                {date.getFullYear()}年
                                <button onClick={() => changeMonth(12)} className="hover:text-gray-600"><i className="fa-solid fa-caret-right mx-2 text-2xl"></i></button>
                            </div>
                            
                            {/* 设置按钮 */}
                            <button 
                                onClick={() => setView('settings')}
                                className="text-black border-2 border-black px-4 py-1.5 rounded-lg font-bold hover:bg-black hover:text-white transition-all flex items-center gap-2 shadow-sm active:shadow-inner"
                            >
                                <i className="fa-solid fa-gear"></i> 設置
                            </button>
                        </div>
                    </div>

                    {/* 日历网格 */}
                    <div className="calendar-grid bg-white shadow-sm md:shadow-lg">
                        {/* 星期头 */}
                        <div className="grid grid-cols-7 text-center font-bold text-sm md:text-lg bg-gray-50 md:bg-white">
                            {WEEKDAYS.map((d, i) => (
                                <div key={i} className={`calendar-header py-2 md:py-3 ${i === 0 || i === 6 ? 'text-blue-600' : 'text-gray-600'} ${i === 0 ? '!text-red-600' : ''}`}>
                                    {d}
                                </div>
                            ))}
                        </div>

                        {/* 日期格子 */}
                        <div className="grid grid-cols-7">
                            {allCells.map((day, index) => {
                                if (!day) return <div key={`blank-${index}`} className="calendar-cell bg-gray-50/50 border-r border-black last:border-r-0 border-b md:border-b-0"></div>;
                                
                                const garbageList = getGarbageForDay(day);
                                const isSunday = index % 7 === 0;
                                const isSaturday = index % 7 === 6;
                                const isTodayCell = isToday(day);

                                return (
                                    <div 
                                        key={day} 
                                        onClick={() => handleDayClick(day, garbageList, index % 7)}
                                        className={`calendar-cell border-r border-black last:border-r-0 border-b md:border-b-0 p-1 relative flex flex-col hover:bg-yellow-50 active:bg-yellow-100 ${isTodayCell ? 'bg-yellow-50 ring-inset ring-2 ring-yellow-400' : 'bg-white'}`}
                                    >
                                        <div className={`font-bold text-lg md:text-xl text-center mb-1 leading-none mt-1 ${isSunday ? 'text-red-600' : (isSaturday ? 'text-blue-600' : 'text-gray-800')}`}>
                                            {day}
                                        </div>
                                        
                                        {/* 手机端：显示小圆点 */}
                                        <div className="md:hidden flex flex-wrap justify-center gap-1 mt-1 content-center h-full pb-2">
                                            {garbageList.slice(0, 4).map((g, idx) => (
                                                <div key={idx} className="w-2 h-2 rounded-full" style={{backgroundColor: g.colorCode}}></div>
                                            ))}
                                            {garbageList.length > 4 && <div className="w-2 h-2 rounded-full bg-gray-300"></div>}
                                        </div>

                                        {/* 桌面端：显示文字标签 */}
                                        <div className="hidden md:flex flex-col gap-1 w-full mt-1">
                                            {garbageList.map((g, idx) => (
                                                <div key={`${day}-${g.id}-${idx}`} className={`text-xs px-1 py-0.5 rounded text-center font-bold truncate leading-tight ${g.style}`}>
                                                    {g.name}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* 弹窗 (Modal) */}
                    {selectedDayInfo && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={closeModal}>
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden modal-enter" onClick={e => e.stopPropagation()}>
                                {/* 弹窗头部 */}
                                <div className="bg-gray-900 text-white p-6 relative">
                                    <button onClick={closeModal} className="absolute top-4 right-4 text-gray-400 hover:text-white">
                                        <i className="fa-solid fa-xmark text-xl"></i>
                                    </button>
                                    <div className="text-sm opacity-80">{date.getFullYear()}年 {date.getMonth() + 1}月</div>
                                    <div className="flex items-baseline gap-2 mt-1">
                                        <span className="text-5xl font-bold">{selectedDayInfo.day}</span>
                                        <span className="text-xl font-bold">({selectedDayInfo.weekDay})</span>
                                    </div>
                                </div>
                                
                                {/* 弹窗内容 */}
                                <div className="p-6">
                                    {selectedDayInfo.garbageList.length > 0 ? (
                                        <>
                                            <h3 className="text-gray-500 text-sm font-bold mb-3 uppercase tracking-wider">今日のゴミ</h3>
                                            <div className="space-y-3">
                                                {selectedDayInfo.garbageList.map((g, i) => (
                                                    <div key={i} className="flex items-center p-3 rounded-xl border border-gray-100 bg-gray-50">
                                                        <div className={`w-4 h-4 rounded-full mr-3 ${g.style.replace('text-', 'bg-').split(' ')[0]} shadow-sm`}></div>
                                                        <span className="text-lg font-bold text-gray-800">{g.name}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </>
                                    ) : (
                                        <div className="text-center py-8 text-gray-400">
                                            <i className="fa-regular fa-calendar-check text-4xl mb-3"></i>
                                            <p>今日は回収がありません</p>
                                        </div>
                                    )}
                                </div>
                                
                                <div className="p-4 border-t bg-gray-50 text-center">
                                    <button onClick={closeModal} className="text-blue-600 font-bold text-sm">閉じる</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>